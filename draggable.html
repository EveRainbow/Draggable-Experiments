<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>jQuery UI Draggable - Default functionality</title>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/resources/demos/style.css">
  <link rel="stylesheet" href="bootstrap.css">
  <style>
  .ui-widget-content { width: 150px; height: 150px; padding: 0.5em; }
  </style>
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="bootstrap.min.js"></script>
  <script src="http://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script>
  $( function() {
    $( "div" ).draggable();
    $( "div" ).resizable()
  } );
  </script>
</head>
<body>
  <div id="screen" class="container" style="border:1px solid lightgray">
    <div id="draggable" class="ui-widget-content" style="background: #673AB7;">
      <p style="color:white;">Drag me around</p>
    </div>
    <div class="ui-widget-content" style="background: #CDDC39;">
        <p>Me too!</p>
    </div>
    <div class="ui-widget-content" style="background: #c666d6;">
        <p style="color:white;">And me ^ __ ^</p>
    </div>
  </div>
<script>

        function addComponent(event) {
        
        file = event.getAttribute("w3-include-html");
        file = file + '.html'; 
            
        console.log(document.getElementsByTagName('div').length -1);
        //file = 'content.html';
        
        function includeHTML() {
        
        xhttp = new XMLHttpRequest();
              xhttp.onreadystatechange = function() {
                if (this.readyState == 4) {
                  //if (this.status == 200) {elmnt.innerHTML = this.responseText;}
                  var emptyDiv = document.createElement("div");
                  //$( emptyDiv).draggable();
                  //$( emptyDiv ).resizable();
                  if (this.status == 200) {
                      document.getElementsByTagName('body')[document.getElementsByTagName('body').length -1].appendChild(emptyDiv);
                      document.getElementsByTagName('div')[document.getElementsByTagName('div').length -1].innerHTML = 				this.responseText; 

                    }
                  if (this.status == 404) {document.getElementsByTagName('div')[document.getElementsByTagName('div').length -1].innerHTML = "Page not found.";}
                  /*remove the attribute, and call this function once more:*/
                  //elmnt.removeAttribute("w3-include-html");
                  //includeHTML();
                }
              }      
              xhttp.open("GET", file, true);
              xhttp.send();
              /*exit the function:*/
              return;
            /*
          var z, i, elmnt, file, xhttp;
        
          z = document.getElementsByTagName("*");
          for (i = 0; i < z.length; i++) {
            elmnt = z[i];
        
            file = elmnt.getAttribute("w3-include-html");
            if (file) {
        
              xhttp = new XMLHttpRequest();
              xhttp.onreadystatechange = function() {
                if (this.readyState == 4) {
                  //if (this.status == 200) {elmnt.innerHTML = this.responseText;}
                  var emptyDiv = document.createElement("div");
                  if (this.status == 200) {
                      document.getElementsByTagName('div')[document.getElementsByTagName('div').length -1].innerHTML = 				this.responseText; 
                    document.getElementsByTagName('body')[document.getElementsByTagName('body').length -1].appendChild(emptyDiv);
                    }
                  if (this.status == 404) {elmnt.innerHTML = "Page not found.";}
        
                  elmnt.removeAttribute("w3-include-html");
                  includeHTML();
                }
              }      
              xhttp.open("GET", file, true);
              xhttp.send();
        
              return;
            }
          }*/
          
        };
        includeHTML();
        console.log('works!');
        /*$( function() {
                $( "div" ).draggable();
                $( "div" ).resizable()
        } );*/
        }
        
        
        /*$.when( addComponent(event) ).done(function() {
            $( function() {
                $( "div" ).draggable();
                $( "div" ).resizable()
            } );
        });*/

        /*$('button').onclick(function() {
            $( "div" ).draggable();
            $( "div" ).resizable();
        })*/

        $('button').on('click', function() {
            $( "div.ui-widget-content" ).draggable();
            $( "div.ui-widget-content" ).resizable();
        })

        function screenshot() {
          html2canvas(document.getElementById('screen'), {
            allowTaint: true}).then(function(canvas) {
            document.body.appendChild(canvas);
          });
        }

        </script>
        
        <button w3-include-html="components/component-Boo" onclick="addComponent(this)">ДОБАВИТЬ КОМПОНЕНТ</button>
        <button onclick="screenshot()">СДЕЛАТЬ СКРИНШОТ</button>
 
 
</body>
</html>